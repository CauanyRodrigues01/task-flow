# História 1.1: Configuração Inicial do Projeto e Autenticação de Usuários

**Status:** Pronto para Desenvolvimento

**Objetivo:** Estabelecer a infraestrutura central da aplicação e a autenticação segura de usuários, permitindo que os usuários façam login e gerenciem seus perfis.

**Contexto:** Esta história aborda o problema fundamental de perda de contexto e ruído de comunicação, fornecendo um ponto de entrada seguro e confiável para a plataforma TaskFlow.

**Padrões:**
*   **Backend:** Monólito Modular (Spring Boot), API RESTful, Segurança com JWT, senhas com hash BCrypt.
*   **Frontend:** Single Page Application (SPA) com UI baseada em componentes (React).
*   **Dados:** Banco de dados MySQL com uma entidade `User` contendo `id`, `name`, `email`, `password_hash` e `role`.

**Declaração da História:** Como usuário, quero me registrar e fazer login no TaskFlow, para que eu possa acessar o sistema com segurança e ter um perfil de usuário definido.

**Critérios de Aceitação:**
1. O sistema deve permitir que novos usuários se registrem com um e-mail e senha válidos.
2. O sistema deve permitir que usuários existentes façam login com suas credenciais.
3. O sistema deve validar as credenciais do usuário e emitir um token JWT válido após o login bem-sucedido.
4. O sistema deve armazenar informações básicas do perfil do usuário (nome, e-mail).
5. O sistema deve atribuir um perfil padrão (Colaborador) a novos usuários no momento do registro.
6. O sistema deve proteger as senhas dos usuários usando técnicas seguras de hash (BCrypt).
7. O sistema deve retornar mensagens de erro claras para tentativas de login ou registro falhas.
8. O comportamento da API/lógica de backend pode ser verificado localmente.

**Notas de Desenvolvimento:**

*   **Insights da História Anterior**: N/A (primeira história).
*   **Modelos de Dados**:
    *   **Entidade Usuário**: `id`, `name`, `email`, `password_hash` (BCrypt), `role` ('COLLABORATOR' por padrão).
        *   [Fonte: architecture/5-modelagem-de-dados.md]
*   **Especificações da API**:
    *   `POST /api/v1/auth/register`: Registra um novo usuário.
    *   `POST /api/v1/auth/login`: Autentica e retorna um token JWT.
        *   [Fonte: architecture/8-especificao-da-api-restful.md]
*   **Localização de Arquivos**:
    *   **Backend**: `taskflow-backend/src/main/java/com/taskflow/user/`, `.../security/`
    *   **Frontend**: `taskflow-frontend/src/features/auth/`
        *   [Fonte: architecture/4-estrutura-unificada-do-projeto-polyrepo.md]
*   **Restrições Técnicas**:
    *   Usar BCrypt para hash de senha.
    *   Usar Spring Security e JWT para autenticação.
    *   Validar entradas no backend com Bean Validation.
        *   [Fonte: architecture/12-consideraes-de-segurana.md]

**Tarefas / Subtarefas:**

1.  **Backend**
    *   Implementar a entidade `User` e o `UserRepository`.
    *   Implementar `UserService` para registro e autenticação.
    *   Implementar `AuthController` com os endpoints `/auth/register` e `/auth/login`.
    *   Configurar Spring Security com JWT e BCrypt.
    *   Escrever testes unitários e de integração.
2.  **Frontend**
    *   Criar os componentes `RegisterForm` e `LoginForm`.
    *   Implementar `authService` para as chamadas de API.
    *   Implementar `AuthContext` para gerenciamento de estado.
    *   Escrever testes de componentes.

## QA Results

### Review Date: 2025-11-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

O backend segue os padrões de arquitetura definidos. O frontend, embora funcional, desvia da arquitetura SPA com React especificada, utilizando uma abordagem de múltiplas páginas HTML com JavaScript. Este desvio foi uma decisão pragmática para garantir o progresso do desenvolvimento, mas introduz débito técnico em termos de manutenibilidade e duplicação de código.

### Refactoring Performed

Nenhum refactoring foi realizado.

### Compliance Check

- Coding Standards: [✓] Backend atende aos padrões. O frontend tem desvios.
- Project Structure: [✓] Backend atende à estrutura. O frontend tem desvios.
- Testing Strategy: [✗] Não há testes de frontend.
- All ACs Met: [✓] Todos os critérios de aceitação foram atendidos.

### Improvements Checklist

- [ ] **Segurança:** Mover o armazenamento de token JWT de `localStorage` para cookies HttpOnly para mitigar riscos de XSS.
- [ ] **Testes:** Introduzir um framework de testes para o frontend (ex: Jest, Testing Library) e criar testes para os fluxos de autenticação.
- [ ] **Arquitetura:** Planejar uma migração gradual do frontend para a arquitetura SPA com React, para reduzir o débito técnico.

### Security Review

- **CONCERNS:** O token JWT é armazenado no `localStorage`, o que é vulnerável a ataques XSS. Esta é a preocupação de segurança mais crítica e deve ser tratada com prioridade.

### Performance Considerations

Nenhuma preocupação de performance no momento.

### Files Modified During Review

Nenhum arquivo foi modificado.

### Gate Status

Gate: CONCERNS → docs/qa/gates/1.1-auth.yml

### Recommended Status

[✓ Ready for Done, with concerns noted]