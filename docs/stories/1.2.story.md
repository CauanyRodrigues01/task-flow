# História 1.2: Gestão de Perfis de Usuário e Permissões Básicas

**Status:** Rascunho

**Objetivo:** Permitir que Administradores gerenciem perfis de usuário e permissões, garantindo o controle de acesso em todo o sistema.

**Contexto:** Com a autenticação estabelecida, esta história foca em capacitar os Administradores para garantir que os dados sejam confiáveis e que as permissões sejam rigorosamente aplicadas, um pilar central do TaskFlow.

**Padrões:**
*   **Backend:** Autorização baseada em papéis com `@PreAuthorize("hasRole('ADMIN')")` em endpoints RESTful.
*   **Frontend:** Roteamento protegido para garantir que apenas usuários com o perfil de Administrador possam acessar a página de gerenciamento.
*   **Dados:** O campo `role` na entidade `User` será atualizado para `ADMIN`, `PROJECT_MANAGER` ou `COLLABORATOR`.

**Declaração da História:** Como Administrador, quero gerenciar perfis de usuário e suas permissões, para que eu possa controlar o acesso às funcionalidades e papéis no sistema.

**Critérios de Aceitação:**
1.  O Administrador deve ter acesso a uma interface para visualizar todos os usuários.
2.  O Administrador deve poder convidar novos usuários (com perfil de Colaborador).
3.  O Administrador deve poder remover usuários existentes.
4.  O Administrador deve poder alterar o perfil de um usuário.
5.  O sistema deve aplicar rigorosamente as permissões baseadas no perfil em todas as operações da API.
6.  O sistema deve registrar as alterações de perfil no histórico de atividades.
7.  O comportamento da API/lógica de backend pode ser verificado localmente.

**Notas de Desenvolvimento:**

*   **Insights da História Anterior**: Baseia-se na história 1.1, que estabeleceu o registro de usuários.
*   **Modelos de Dados**:
    *   Atualização do campo `role` na entidade `User`.
        *   [Fonte: architecture/5-modelagem-de-dados.md]
*   **Especificações da API**:
    *   Endpoints para `GET /users`, `POST /users`, `PUT /users/{userId}/role`, `DELETE /users/{userId}`.
    *   Endpoints protegidos para acesso exclusivo de `ADMIN`.
        *   [Fonte: architecture/6-arquitetura-do-backend-monlito-modular.md#6.3-autenticação-e-autorização]
*   **Localização de Arquivos**:
    *   **Backend**: `taskflow-backend/src/main/java/com/taskflow/user/`
    *   **Frontend**: `taskflow-frontend/src/features/admin/`
        *   [Fonte: architecture/4-estrutura-unificada-do-projeto-polyrepo.md]
*   **Restrições Técnicas**:
    *   Uso de `@PreAuthorize` no backend para controle de acesso.

**Tarefas / Subtarefas:**

1.  **Backend**
    *   Implementar `UserController` com endpoints para gerenciamento de usuários.
    *   Implementar `UserService` para a lógica de negócio.
    *   Proteger os endpoints com `@PreAuthorize("hasRole('ADMIN')")`.
    *   Escrever testes unitários e de integração.
2.  **Frontend**
    *   Criar a página `UserManagementPage`.
    *   Criar o formulário `UserForm`.
    *   Implementar `userService` para as chamadas de API.
    *   Proteger a rota de gerenciamento de usuários.
    *   Escrever testes de componentes.