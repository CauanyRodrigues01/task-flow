# História 1.1: Configuração Inicial do Projeto e Autenticação de Usuários

**Status:** Rascunho

**Declaração da História:** Como usuário, quero me registrar e fazer login no TaskFlow, para que eu possa acessar o sistema com segurança e ter um perfil de usuário definido.

**Critérios de Aceitação:**
1. O sistema deve permitir que novos usuários se registrem com um e-mail e senha válidos.
2. O sistema deve permitir que usuários existentes façam login com suas credenciais.
3. O sistema deve validar as credenciais do usuário e emitir um token JWT válido após o login bem-sucedido.
4. O sistema deve armazenar informações básicas do perfil do usuário (nome, e-mail).
5. O sistema deve atribuir um perfil padrão (Colaborador) a novos usuários no momento do registro.
6. O sistema deve proteger as senhas dos usuários usando técnicas seguras de hash.
7. O sistema deve retornar mensagens de erro claras para tentativas de login ou registro falhas (por exemplo, credenciais inválidas, e-mail já registrado).
8. O comportamento da API/lógica de backend para esta funcionalidade pode ser verificado localmente (ex: via chamada direta à API, CLI ou teste de unidade/integração).

**Notas de Desenvolvimento:**

*   **Insights da História Anterior**: Nenhum contexto de história anterior disponível, pois esta é a primeira história.
*   **Modelos de Dados**:
    *   **Entidade Usuário**:
        *   `id`: BIGINT AUTO_INCREMENT PRIMARY KEY
        *   `name`: VARCHAR(255) NOT NULL
        *   `email`: VARCHAR(255) NOT NULL UNIQUE
        *   `password_hash`: VARCHAR(255) NOT NULL (armazenará hash BCrypt)
        *   `role`: VARCHAR(50) NOT NULL (padrão para 'COLLABORATOR' para novos registros)
        *   `created_at`: DATETIME DEFAULT CURRENT_TIMESTAMP
        *   [Fonte: architecture.md#5.2-esquema-do-banco-de-dados-mysql-ddl]
    *   **Papéis**:
        *   `COLLABORATOR`: Papel padrão para novos usuários.
        *   [Fonte: architecture.md#5.1-modelo-conceitual-e-papéis]
*   **Especificações da API**:
    *   **URL Base**: `/api/v1`
    *   `POST /auth/register`: Registra um novo usuário.
        *   Corpo da Requisição: `{"name": "string", "email": "string", "password": "string"}`
        *   Resposta: `201 Created` em caso de sucesso, `400 Bad Request` em erros de validação (por exemplo, e-mail já registrado).
    *   `POST /auth/login`: Autentica um usuário e retorna um token JWT.
        *   Corpo da Requisição: `{"email": "string", "password": "string"}`
        *   Resposta: `200 OK` com token JWT em caso de sucesso, `401 Unauthorized` em credenciais inválidas.
    *   [Fonte: architecture.md#8.1-autenticação-auth]
*   **Especificações de Componentes**:
    *   **Frontend (React)**:
        *   `src/features/auth/RegisterForm.tsx`: Componente para registro de usuário.
        *   `src/features/auth/LoginForm.tsx`: Componente para login de usuário.
        *   `src/services/authService.ts`: Serviço para lidar com chamadas de API para autenticação.
        *   `src/contexts/AuthContext.tsx`: Contexto React para estado de autenticação global.
        *   [Fonte: architecture.md#7.1-organização-de-pastas]
*   **Localização de Arquivos**:
    *   **Backend (Java/Spring Boot)**:
        *   `taskflow-backend/src/main/java/com/taskflow/user/`: Entidades, serviços, repositórios relacionados ao usuário.
        *   `taskflow-backend/src/main/java/com/taskflow/security/`: Componentes de segurança (filtro JWT, provedor de autenticação).
        *   [Fonte: architecture.md#4-estrutura-unificada-do-projeto-polyrepo]
    *   **Frontend (React/TypeScript)**:
        *   `taskflow-frontend/src/features/auth/`: Componentes de funcionalidade de autenticação.
        *   `taskflow-frontend/src/services/`: Serviços de cliente de API.
        *   `taskflow-frontend/src/contexts/`: Contextos React.
        *   [Fonte: architecture.md#4-estrutura-unificada-do-projeto-polyrepo]
*   **Requisitos de Teste**:
    *   **Testes Unitários de Backend**:
        *   Testar `UserService` para lógica de registro e autenticação de usuário.
        *   Simular `UserRepository` e `PasswordEncoder`.
        *   [Fonte: architecture.md#11.1-testes-de-backend]
    *   **Testes de Integração de Backend**:
        *   Testar endpoints de `AuthController` (`/auth/register`, `/auth/login`) usando `@SpringBootTest`.
        *   Verificar interações com o banco de dados e geração de token JWT.
        *   [Fonte: architecture.md#11.1-testes-de-backend]
    *   **Testes de Componentes de Frontend**:
        *   Testar componentes `RegisterForm` e `LoginForm` usando Jest e React Testing Library.
        *   Simular entrada do usuário e envio de formulário.
        *   [Fonte: architecture.md#11.2-testes-de-frontend]
*   **Restrições Técnicas**:
    *   **Hash de Senha**: Usar BCrypt para proteção de senha. [Fonte: architecture.md#12-considerações-de-segurança]
    *   **JWT**: Spring Security e JWT para autenticação. [Fonte: architecture.md#6.3-autenticação-e-autorização]
    *   **Validação**: Validação de entrada de backend usando Bean Validation (`@Valid`). [Fonte: architecture.md#12-considerações-de-segurança]
    *   **CORS**: Backend configurado para permitir requisições de `http://localhost:3000`. [Fonte: architecture.md#12-considerações-de-segurança]

**Tarefas / Subtarefas:**

1.  **Desenvolvimento de Backend (CA: 1, 2, 3, 4, 5, 6, 7, 8)**
    *   Implementar entidade `User` e `UserRepository` em `taskflow-backend/src/main/java/com/taskflow/user/`. [Fonte: architecture.md#5.2-esquema-do-banco-de-dados-mysql-ddl]
    *   Implementar `UserService` para registro de usuário (hash de senha com BCrypt, atribuição do papel 'COLLABORATOR') e autenticação. [Fonte: architecture.md#6.2-camada-de-acesso-a-dados, architecture.md#12-considerações-de-segurança]
    *   Implementar `AuthController` com endpoints `POST /api/v1/auth/register` e `POST /api/v1/auth/login`. [Fonte: architecture.md#8.1-autenticação-auth]
    *   Configurar Spring Security para autenticação JWT e codificação de senha. [Fonte: architecture.md#6.3-autenticação-e-autorização]
    *   Adicionar validação de entrada aos DTOs para registro e login. [Fonte: architecture.md#12-considerações-de-segurança]
    *   **Testes Unitários**: Escrever testes unitários para `UserService` (lógica de registro, autenticação). [Fonte: architecture.md#11.1-testes-de-backend]
    *   **Testes de Integração**: Escrever testes de integração para `AuthController` (registro, login, geração de JWT). [Fonte: architecture.md#11.1-testes-de-backend]
2.  **Desenvolvimento de Frontend (CA: 1, 2, 3, 7)**
    *   Criar componente `RegisterForm` em `taskflow-frontend/src/features/auth/`. [Fonte: architecture.md#7.1-organização-de-pastas]
    *   Criar componente `LoginForm` em `taskflow-frontend/src/features/auth/`. [Fonte: architecture.md#7.1-organização-de-pastas]
    *   Implementar `authService` em `taskflow-frontend/src/services/` para interagir com `/api/v1/auth/register` e `/api/v1/auth/login` usando Axios. [Fonte: architecture.md#3-definição-da-tech-stack]
    *   Implementar `AuthContext` em `taskflow-frontend/src/contexts/` para gerenciar o estado de autenticação do usuário e o token JWT. [Fonte: architecture.md#7.2-gerenciamento-de-estado]
    *   **Testes de Componentes**: Escrever testes de componentes para `RegisterForm` e `LoginForm`. [Fonte: architecture.md#11.2-testes-de-frontend]

**Notas sobre a Estrutura do Projeto:**
*   As localizações de arquivos identificadas para os componentes de backend e frontend estão alinhadas com a estrutura `Polyrepo` definida no documento de arquitetura.