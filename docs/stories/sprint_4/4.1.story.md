# História 4.1: Painel Principal (Dashboard)

## Status
Pronto para Desenvolvimento

## História
**Como um** usuário (Gerente de Projeto ou Administrador),
**Eu quero** ter um painel principal que me dê uma visão geral rápida do status das tarefas e projetos,
**para que** eu possa acompanhar o progresso e identificar rapidamente áreas que precisam de atenção.

## Critérios de Aceitação
1. O painel principal deve exibir uma contagem de tarefas por status (A Fazer, Em Andamento, Concluído) para os projetos aos quais o usuário tem acesso.
2. O painel deve exibir um resumo do progresso do projeto (ex: porcentagem de tarefas concluídas).
3. O painel deve ser personalizável para que o usuário possa focar nas informações mais relevantes para ele (ex: filtrar por projeto).
4. As informações no painel devem ser atualizadas em tempo real ou com atraso mínimo.
5. O comportamento da API/lógica de backend para esta funcionalidade pode ser verificado localmente (ex: via chamada direta à API, CLI ou teste de unidade/integração).

## Notas do Desenvolvedor

### Modelos de Dados
- Não são necessárias novas entidades de banco de dados. O painel agregará dados de `Tasks` e `Projects`.
- [Fonte: architecture/5-modelagem-de-dados.md]

### Especificações da API
- **Endpoint para dados do Painel:** `GET /dashboard`
  - **Permissão:** `ADMIN`, `PROJECT_MANAGER`.
  - **Parâmetros de Query:** `projectId` (opcional, para filtragem).
  - **Resposta:** Um objeto JSON contendo:
    - `totalTasks`: Contagem total de tarefas.
    - `tasksByStatus`: Objeto com contagens por status (ex: `{ "TODO": 10, "IN_PROGRESS": 5, "DONE": 15 }`).
    - `projectProgressSummary`: Objeto com resumo do progresso (ex: `{ "completedPercentage": 50, "totalProjects": 3 }`).
- [Fonte: architecture/8-especificao-da-api-restful.md (Adaptado para nova funcionalidade)]

### Arquitetura do Backend
- Criar um novo pacote `com.taskflow.dashboard`.
- Este pacote conterá `DashboardService.java` (lógica de agregação de dados) e `DashboardController.java`.
- O `DashboardService` utilizará `TaskRepository` e `ProjectRepository` para buscar e agregar os dados necessários.
- [Fonte: architecture/6-arquitetura-do-backend-monlito-modular.md]

### Arquitetura do Frontend
- Criar um novo módulo de funcionalidade `dashboard` em `taskflow-frontend/src/features/`.
- Este módulo conterá o componente `DashboardPage.tsx` (para a página principal do painel) e `DashboardWidgets.tsx` (para os componentes de exibição de dados).
- Utilizar um hook customizado (ex: `useDashboardData`) para buscar os dados da API e gerenciar o estado de carregamento/erro.
- [Fonte: architecture/7-arquitetura-do-frontend-spa.md]

### Localização dos Arquivos (Backend)
- `taskflow-backend/src/main/java/com/taskflow/dashboard/DashboardService.java`
- `taskflow-backend/src/main/java/com/taskflow/dashboard/DashboardController.java`
- `taskflow-backend/src/main/java/com/taskflow/dashboard/dto/DashboardResponseDto.java`
- [Fonte: architecture/4-estrutura-unificada-do-projeto-polyrepo.md]

### Localização dos Arquivos (Frontend)
- `taskflow-frontend/src/features/dashboard/DashboardPage.tsx`
- `taskflow-frontend/src/features/dashboard/DashboardWidgets.tsx`
- `taskflow-frontend/src/features/dashboard/hooks/useDashboardData.ts`
- `taskflow-frontend/src/services/dashboardService.ts` (para chamadas à API)
- `taskflow-frontend/src/pages/Dashboard.tsx` (para a rota da página)
- [Fonte: architecture/4-estrutura-unificada-do-projeto-polyrepo.md]

## Tarefas / Subtarefas
- [ ] **Backend: Serviço** (CA: 1, 2, 4)
  - [ ] Criar `DashboardService.java`.
  - [ ] Implementar método `getDashboardData(Long userId, Long projectId)` que:
    - [ ] Busca tarefas e projetos aos quais o `userId` tem acesso.
    - [ ] Calcula a contagem de tarefas por status.
    - [ ] Calcula a porcentagem de tarefas concluídas por projeto.
    - [ ] Agrega os dados no `DashboardResponseDto`.
- [ ] **Backend: Controlador** (CA: 1, 2, 3, 4)
  - [ ] Criar `DashboardController.java` com o endpoint `GET /dashboard`.
  - [ ] Proteger o endpoint com `@PreAuthorize` para `ADMIN` e `PROJECT_MANAGER`.
  - [ ] Implementar a lógica para receber `projectId` opcional e passar para o serviço.
- [ ] **Frontend: Serviço de API** (CA: 4)
  - [ ] Criar `dashboardService.ts` para fazer chamadas ao endpoint `/dashboard`.
- [ ] **Frontend: Hooks** (CA: 4)
  - [ ] Criar `useDashboardData.ts` para gerenciar o estado de carregamento e dados do painel.
- [ ] **Frontend: Componentes** (CA: 1, 2, 3, 4)
  - [ ] Criar `DashboardWidgets.tsx` para exibir as contagens de tarefas por status e o resumo do progresso.
  - [ ] Criar `DashboardPage.tsx` para montar o layout do painel, incluindo filtros de projeto.
  - [ ] Integrar o `useDashboardData` nos componentes do painel.
- [ ] **Frontend: Roteamento**
  - [ ] Adicionar uma rota para `/dashboard` em `taskflow-frontend/src/pages/Dashboard.tsx`.
- [ ] **Testes** (CA: 5)
  - [ ] Escrever testes unitários para `DashboardService` (backend).
  - [ ] Escrever testes de integração para `DashboardController` (backend).
  - [ ] Escrever testes de componentes para `DashboardWidgets` (frontend).

## Testes
- **Backend:** Testes unitários para `DashboardService` e testes de integração para `DashboardController`.
- **Frontend:** Testes de componentes para os widgets do painel usando Jest e React Testing Library.
- [Fonte: architecture/11-estratgia-de-testes.md]

## Log de Alterações
| Data | Versão | Descrição | Autor |
|---|---|---|---|
| 2025-11-06 | 1.0 | Rascunho inicial | sm |