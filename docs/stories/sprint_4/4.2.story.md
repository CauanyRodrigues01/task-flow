# História 4.2: Relatórios Básicos de Tarefas

## Status
Pronto para Desenvolvimento

## História
**Como um** Gerente de Projeto ou Administrador,
**Eu quero** gerar relatórios básicos sobre tarefas,
**para que** eu possa analisar o progresso и compartilhar informações com outras partes interessadas.

## Critérios de Aceitação
1. O sistema deve permitir a geração de um relatório simples de tarefas por projeto.
2. O relatório deve incluir informações como título da tarefa, responsável, status, prioridade e data de vencimento.
3. O sistema deve permitir a exportação do relatório para o formato CSV.
4. O relatório deve refletir os dados mais recentes do sistema.
5. O comportamento da API/lógica de backend para esta funcionalidade pode ser verificado localmente (ex: via chamada direta à API, CLI ou teste de unidade/integração).

## Notas do Desenvolvedor

### Especificações da API
- **Endpoint para Geração de Relatório:** `GET /reports/tasks`
  - **Permissão:** `ADMIN`, `PROJECT_MANAGER`.
  - **Parâmetros de Query:** `projectId` (obrigatório).
  - **Resposta:** Um arquivo CSV (`text/csv`) com os dados das tarefas.
- [Fonte: architecture/8-especificao-da-api-restful.md (Adaptado para nova funcionalidade)]

### Arquitetura do Backend
- Criar um novo pacote `com.taskflow.report`.
- Este pacote conterá `ReportService.java` e `ReportController.java`.
- O `ReportService` será responsável por:
  - Buscar os dados das tarefas para um determinado projeto.
  - Formatar os dados no formato CSV. Uma biblioteca como OpenCSV ou Apache Commons CSV pode ser usada para isso.
- [Fonte: architecture/6-arquitetura-do-backend-monlito-modular.md]

### Localização dos Arquivos (Backend)
- `taskflow-backend/src/main/java/com/taskflow/report/ReportService.java`
- `taskflow-backend/src/main/java/com/taskflow/report/ReportController.java`
- `taskflow-backend/pom.xml` (para adicionar dependência de biblioteca CSV, se necessário)
- [Fonte: architecture/4-estrutura-unificada-do-projeto-polyrepo.md]

## Tarefas / Subtarefas
- [ ] **Backend: Dependência** (CA: 3)
  - [ ] Adicionar uma biblioteca de manipulação de CSV (ex: OpenCSV) ao `pom.xml`.
- [ ] **Backend: Serviço** (CA: 1, 2, 3, 4)
  - [ ] Criar `ReportService.java`.
  - [ ] Implementar o método `generateTaskReport(Long projectId)` que:
    - [ ] Busca todas as tarefas do `projectId`.
    - [ ] Mapeia os dados das tarefas para o formato do relatório (título, responsável, status, etc.).
    - [ ] Converte os dados para uma string no formato CSV.
- [ ] **Backend: Controlador** (CA: 1, 3)
  - [ ] Criar `ReportController.java` com o endpoint `GET /reports/tasks`.
  - [ ] Configurar o endpoint para retornar o `Content-Type` como `text/csv`.
  - [ ] Implementar a lógica para chamar o `ReportService` e retornar o CSV gerado.
  - [ ] Proteger o endpoint com `@PreAuthorize` para `ADMIN` e `PROJECT_MANAGER`.
- [ ] **Frontend: UI (Alto Nível)** (CA: 1)
  - [ ] (Nota para o dev Frontend) Adicionar um botão "Exportar para CSV" na interface de visualização de projetos ou no painel.
  - [ ] (Nota para o dev Frontend) Ao clicar no botão, o frontend deve fazer uma chamada ao endpoint `GET /reports/tasks?projectId={id}` e acionar o download do arquivo CSV retornado.
- [ ] **Backend: Testes** (CA: 5)
  - [ ] Escrever testes unitários para `ReportService` para garantir que a formatação CSV está correta.
  - [ ] Escrever testes de integração para `ReportController` para verificar se o endpoint retorna o conteúdo e o header corretos.

## Testes
- **Testes Unitários (Backend):** Focar em `ReportService` para validar a correta geração do conteúdo CSV a partir de uma lista de tarefas mockada.
- **Testes de Integração (Backend):** Testar o `ReportController` para garantir que o endpoint está protegido e retorna uma resposta HTTP 200 com o `Content-Type` `text/csv`.
- [Fonte: architecture/11-estratgia-de-testes.md]

## Log de Alterações
| Data | Versão | Descrição | Autor |
|---|---|---|---|
| 2025-11-06 | 1.0 | Rascunho inicial | sm |